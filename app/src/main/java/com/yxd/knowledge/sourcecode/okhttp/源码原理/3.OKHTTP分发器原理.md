# OKHTTPåˆ†å‘å™¨åŸç†

å¿…èƒŒå…³é”®è¯
1. RealCall
2. Dispatcher
3. AsyncCall
4. runningAsyncCalls
5. readyAsyncCalls

### åˆ†å‘å™¨å¼‚æ­¥è¯·æ±‚æµç¨‹æ€»ç»“
1. <font color=#dea32c>**OkHttpClient**</font>è°ƒç”¨<font color=#dea32c>**newCall**</font>åä¼šç”Ÿæˆä¸€ä¸ª<font color=#dea32c>**RealCall**</font>ã€‚
2. é€šè¿‡<font color=#dea32c>**RealCall**</font>æ¥æ‰§è¡Œ<font color=#dea32c>**enqueue**</font>æ–¹æ³•å‘èµ·å¼‚æ­¥è¯·æ±‚ï¼Œå†…éƒ¨ä¼šè°ƒç”¨<font color=#dea32c>**Dispatcher**</font>çš„<font color=#dea32c>**enqueue**</font>ï¼Œä¼ å…¥ä¸€ä¸ª<font color=#dea32c>**AysncCall**</font>å¯¹è±¡ã€‚
3. <font color=#dea32c>**Dispatcher**</font>ä¼šæ ¹æ®æ­£åœ¨æ‰§è¡Œçš„è¯·æ±‚æ•°å’Œæ­£åœ¨æ‰§è¡Œçš„åŒåŸŸåè¯·æ±‚æ•°æ¥å†³å®šå°†<font color=#dea32c>**AysncCall**</font>æ”¾å…¥<font color=#dea32c>**runningAysncCalls**</font>è¿˜æ˜¯<font color=#dea32c>**ReadyAsyncCalls**</font>ã€‚
4. å¦‚æœæ”¾å…¥<font color=#dea32c>**runningAsyncCalls**</font>ï¼Œåˆ™ä¼šç”±çº¿ç¨‹æ± æ¥è°ƒåº¦æ‰§è¡Œã€‚
5. å¦‚æœæ”¾å…¥<font color=#dea32c>**readyAysncCalls**</font>ï¼Œåˆ™ä¼šåœ¨è¯·æ±‚å®Œæˆåç”±<font color=#dea32c>**Dispatcher**</font>å†æ¬¡å°è¯•æ”¾å…¥<font color=#dea32c>**runningAsyncCalls**</font>ä¸­ã€‚
   ![](img/582d4069.png)

***

## newCallæ–¹æ³•åˆ›å»ºRealCall
RealCallå®ç°äº†Callæ¥å£ï¼Œåˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

![](img/ee323967.png)

***

## enqueueå¼‚æ­¥è¯·æ±‚æºç è§£æ
> ### <font color=#33a3dc>**RealCall.enqueue()**</font>
> ![](img/81be13c1.png)
> ### ä»£ç åˆ†æ
> 1. åœ¨åŒæ­¥ä»£ç å—ä¸­åˆ¤æ–­è¯·æ±‚æ˜¯å¦å·²è¢«æ‰§è¡Œï¼Œæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œé˜²æ­¢é‡å¤è¯·æ±‚ã€‚
> 2. eventListeneræ‰§è¡Œç›‘å¬ï¼Œä¾‹å¦‚ç›‘å¬è¯·æ±‚å¼€å§‹ï¼ŒDNSè§£æå¼€å§‹ï¼ŒDNSè§£æç»“æŸï¼Œè¿æ¥å¼€å§‹ç­‰ç­‰ã€‚
> 3. <font color=#dea32c>**æ ¸å¿ƒä»£ç ã€‚è°ƒç”¨åˆ†å‘å™¨çš„enqueueæ–¹æ³•ï¼Œä¼ å…¥äº†AsyncCall(å°è£…äº†è¯·æ±‚ä¿¡æ¯)ã€‚**</font>

> ### <font color=#33a3dc>**Dispatcher.enqueue**</font>
>
>![](img/034f33b6.png)
> 
> ### ä»£ç åˆ†æ
> ***
> â‘  åˆ¤æ–­æ­£åœ¨æ‰§è¡Œçš„å¼‚æ­¥è¯·æ±‚ä¸ªæ•°ä¸å¤§äº64  
> ![](img/5741a321.png)
> ![](img/8d874f96.png)
> ***
> â‘¡ é™åˆ¶åŒä¸€ä¸ªåŸŸåçš„è¯·æ±‚æ•°ä¸å¤§äº5  
> ![](img/e2248cd9.png)
> ![](img/b8784e8e.png)
> ***
> â‘¢ å¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™å°†AsyncCallæ”¾å…¥runningAysncCallsï¼Œè®©çº¿ç¨‹æ± å»æ‰§è¡Œã€‚ 
> 
> >ğŸ¤” çº¿ç¨‹æ± çš„executeåšäº†ä»€ä¹ˆï¼Ÿ
> 
> ![](img/5865c09d.png)
> 
> >ğŸ¤” finishedæ–¹æ³•åšäº†ä»€ä¹ˆ
> 
> ![](img/f20c8977.png)
> 
> åœ¨promoteCallsä¸­å°†readyä»»åŠ¡æ”¾å…¥runningä¸­æ‰§è¡Œ
> 
> ![](img/bc4e580b.png)
> 
> ***
> â‘£ å¦‚æœæ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™æ”¾å…¥runningSyncCallsã€‚
> 
> <font color=#dea32c>**æ¯å®Œæˆä¸€æ¬¡è¯·æ±‚ï¼Œåˆ†å‘å™¨ä¼šå°è¯•å°†readyä¸­çš„ä»»åŠ¡æ”¾å…¥åˆ°runningä¸­å»æ‰§è¡Œ**</font>ã€‚
> 
> > #### Dispatcherä¸­çš„ä¸‰ä¸ªæ•°ç»„åŒç«¯é˜Ÿåˆ—ï¼š  
> >![](img/38c6074d.png)  
> <font color=#dea32c>**runningAysncCalls**</font>ï¼šæ­£åœ¨æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ã€‚  
> <font color=#dea32c>**readAysncCalls**</font>ï¼šå‡†å¤‡æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ã€‚  
> <font color=#dea32c>**runningSyncCalls**</font>ï¼šæ­£åœ¨æ‰§è¡Œçš„åŒæ­¥ä»»åŠ¡é˜Ÿåˆ—ã€‚
> 
> 
> 

***

![](img/a2e27900.png)