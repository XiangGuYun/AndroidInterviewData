# Glideç”Ÿå‘½å‘¨æœŸç»‘å®š

## ç”Ÿå‘½å‘¨æœŸç»‘å®š

### æ€è€ƒğŸ¤”
åœ¨Glide.withä¸­ï¼Œä¼ å…¥çš„æ˜¯ä¸€ä¸ªActivityï¼ŒGlideä¼šæŒæœ‰äº†Activityçš„å¼•ç”¨ï¼Œ

é‚£ä¹ˆå½“Activityé”€æ¯åï¼ŒGlideçš„çº¿ç¨‹æ± å¦‚æœä»åœ¨è¿è¡Œï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼å—ï¼Ÿ

> ä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚
> 
> >Glideä¼šåˆ›å»ºä¸€ä¸ªç©ºç™½çš„fragmentä¾é™„åœ¨Activityä¸Šï¼Œæ¥ç›‘å¬å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚
> >å½“activityé”€æ¯æ—¶ä¼šè‡ªåŠ¨å¤„ç†èµ„æºå›æ”¶é—®é¢˜ã€‚

![](img/ca843e4f.png)

<br>

## ç”Ÿå‘½å‘¨æœŸä½œç”¨åŸŸ

### æ€è€ƒğŸ¤”
Glide.with()ä¸ºä»€ä¹ˆä¼šæœ‰é‚£ä¹ˆå¤šé‡è½½æ–¹æ³•ï¼Ÿ

![](img/d51c54a7.png)

> ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼ŒGlideçš„ç”Ÿå‘½å‘¨æœŸä½œç”¨åŸŸä¼šä¸ä¸€æ ·ã€‚
> 
> å¦‚æœæ˜¯åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºï¼Œæ— è®ºä»€ä¹ˆå‚æ•°ï¼Œä½œç”¨åŸŸéƒ½åŒäºApplicationã€‚
> 
> å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºï¼š
> 
> 1. View: Activity/Fragment
> 2. Fragmentï¼šFragment
> 3. Activityï¼šActivity
> 4. Serviceçš„Context/Applicationï¼šApplication

### ç”Ÿå‘½å‘¨æœŸä½œç”¨åŸŸ

#### åœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨Glide
å­çº¿ç¨‹ä¸­ä¸èƒ½åˆ›å»ºfragmentï¼Œæ— æ³•åšç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

å¦‚æœå¼•ç”¨Activityå¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨å…¨å±€Contextã€‚

``` java
class ApplicationLifecycle implements Lifecycle {
  @Override
  public void addListener(@NonNull LifecycleListener listener) {
    listener.onStart();
  }

  @Override
  public void removeListener(@NonNull LifecycleListener listener) {
    // Do nothing.
  }
}
```

## æºç åˆ†æ

#### RequestManagerRetriever.java
``` java
@NonNull
public RequestManager get(@NonNull FragmentActivity activity) {
    if (Util.isOnBackgroundThread()) {
      // å¦‚æœåœ¨å­çº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨å…¨å±€contextï¼ŒåŒæ—¶ä¼šå°†å¤±å»ç”Ÿå‘½å‘¨æœŸç®¡ç†
      return get(activity.getApplicationContext());
    } else {
      // ...
      return supportFragmentGet(activity, fm, /*parentHint=*/ null, isActivityVisible(activity));
    }
}
```

``` java
  @NonNull
private RequestManager supportFragmentGet(
    @NonNull Context context,
    @NonNull FragmentManager fm,
    @Nullable Fragment parentHint,
    boolean isParentVisible) {
      
    // currentæ˜¯ä¸€ä¸ªç©ºç™½çš„fragment 
    SupportRequestManagerFragment current = getSupportRequestManagerFragment(fm, parentHint);
    RequestManager requestManager = current.getRequestManager();
    // requestManagerä¸ä¼šé‡å¤åˆ›å»º
    if (requestManager == null) {
ã€‘      Glide glide = Glide.get(context);
      requestManager =
          factory.build(
              glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);
      if (isParentVisible) {
        requestManager.onStart();
      }
      current.setRequestManager(requestManager);
    }
    return requestManager;
}
```