# 初始容量和扩容机制

## 初始容量
jdk1.8之前是16，之后是0（容量在首次put后设置）。

***

## 扩容
扩容是耗性能的操作，最好一开始就设定好初始容量，避免频繁扩容。

### 扩容时机
数据大小 > 容量 x 负载因子0.75

> 例如，初始容量为16的HashMap在插入第13个元素时，就会进行扩容。

### 扩容过程

1. 创建一个原数组<font color=#dea32c>**2倍**</font>大小的新数组。
2. 遍历原数组，将所有的entry移入新数组。
3. 重新计算元素的hash值。
> 🤔：为什么要重新计算？  
> ***
> 数组下标 = hashcode%(length-1)，当长度发生改变时，原先的下标值也会发生改变。

***

## 为什么容量必须是2的N次幂？ 

首先必须掌握Java的[位运算](doc/java位运算.md)。

本质原因：避免hash冲突。  
当容量值是2的N次幂时，进行与位运算时，可以只看后几位，无需全部重新计算。
