# Webview与JS交互

## Webview调用JS代码

> JS代码调用一定要在 onPageFinished（） 回调之后才能调用，否则不会被调用。

### 1. 通过WebView的loadUrl() 
  1. 设置支持JS接口
  2. 加载html本地文件或远程url
  3. 调用html中的js方法

[查看演示](doc/WebviewLoadUrl.md)


### 2. 通过WebView的evaluateJavascript()
1. evaluateJavascript不会使页面刷新，而loadUrl则会。
2. Android 4.4 后才可使用

```java
// 只需要将第一种方法的loadUrl()换成下面该方法即可
mWebView.evaluateJavascript("javascript:callJS()", new ValueCallback<String>() {
    @Override
    public void onReceiveValue(String value) {
        //此处为 js 返回的结果
    }
});
}
```

### 方法对比
![](https://img-blog.csdnimg.cn/img_convert/b7c70efb0bb2dd1f58b0bd4144c6b66c.png)

***

## JS通过Webview调用Android代码

### 1. 通过WebView的addJavascriptInterface()进行对象映射
1. 步骤1：定义一个与JS对象映射关系的Android类。
2. 步骤2：将JS代码以.html格式放到src/main/assets文件夹里。
3. 步骤3：通过WebView设置Android类与JS代码的映射。

[查看演示](doc/AndroidJS对象映射.md)

1. 优点：使用简单。
2. 缺点：存在严重的漏洞问题，[你不知道的AndroidWebView使用漏洞](https://www.jianshu.com/p/3a345d27cd42)

### 2. 通过WebViewClient的shouldOverrideUrlLoading()方法回调拦截url

### 3. 通过WebChromeClient的onJsAlert()、onJsConfirm()、onJsPrompt()方法回调拦截JS对话框alert()、confirm()、prompt() 消息
